# CVE-2025-46571 (OpenWebUI) — Limited Stored XSS via HTML File Upload → Admin Token Exfiltration → Account Takeover → Model Output Manipulation (Lab Case)

## Overview

This lab case documents a controlled validation of **CVE-2025-46571** in **OpenWebUI**. Public advisories describe a **limited stored cross-site scripting (XSS)** issue: a low-privileged user can upload an **HTML file containing JavaScript** through the backend endpoint **`/api/v1/files/`**. The endpoint returns a **file id** that can be used to open the file in a browser, which may execute the embedded JavaScript in the viewer’s session. Under default settings, low-privileged uploads are typically viewable only by **admins or the uploader**, limiting the initial blast radius—but still enabling targeted attacks against admins. 

This case demonstrates three security outcomes:

1. **Admin token exfiltration (lab-only):** when an admin views the uploaded HTML in-browser, attacker JavaScript can access client-side session/token material and send it to an attacker-controlled listener. 
2. **Admin account takeover:** the exfiltrated admin token enables API-level impersonation of the admin account. 
3. **Model output manipulation (primary objective):** once admin, the attacker can modify **model configuration and prompting controls** (e.g., temperature, system prompt, templates, routing defaults), **shaping semantic output** seen by end-users. (This is an integrity attack on the AI system’s behavior.)

- **CVE:** CVE-2025-46571 
- **Product:** OpenWebUI 
- **Affected versions:** **prior to 0.6.6**
- **Fix:** upgrade to **0.6.6+** 
- **Core chain:** **HTML upload → in-browser render → XSS → token theft → admin takeover → AI config tampering**

> ⚠️ Responsible Use Only
>  This README is for **isolated lab validation** and **defensive verification**.
>  It deliberately keeps exploitation steps **high-level** and uses placeholders instead of copy-paste payloads.

------

## Critical Clarification (This is not prompt injection)

This vulnerability is **not** prompt injection.

- **Root cause:** a stored XSS path introduced by allowing **user-supplied HTML** to be **rendered** in a browser context. 
- **Prompt/system manipulation happens later:** it is a **post-compromise impact** after the attacker obtains **admin privileges** and uses legitimate admin controls to change model settings.

------

## Why “Becoming Admin” is Not the End Goal

In this case, **admin takeover is the pivot** to the real objective:

### Primary impact: **Semantic output manipulation**

Once admin, an attacker can change AI behavior by modifying:

- **Temperature / randomness** (e.g., to increase hallucinations or unpredictability)
- **Default system prompt / policy prompt** (to bias responses, weaken safety constraints, or insert hidden directives)
- **Prompt templates / conversation wrappers** (to steer style, omissions, refusals)
- **Model selection / routing defaults** (to downgrade models, route to attacker-controlled endpoints, or alter tool access)
- **Global knobs** that influence **all users’** outputs (integrity compromise)

This turns CVE-2025-46571 from “token theft” into a platform-wide **trust and integrity** issue: users receive outputs that reflect the attacker’s configuration rather than the intended system behavior.

------

## Lab Topology (What We Ran)

- **OpenWebUI (victim)** running locally (example: `http://127.0.0.1:8080`), with default roles: one **admin** and one **regular user**.
- **Attacker listener** (lab-only) to receive exfiltrated data (e.g., a simple HTTP receiver / netcat).
- **Browser sessions**:
  - Admin browser session (victim)
  - Low-privileged user browser session (attacker)

------

## High-Level Vulnerability Mechanism

Public sources describe CVE-2025-46571 as:

- Low-privileged users can upload **HTML** containing JavaScript via **`/api/v1/files/`**. 
- The server returns a **file id**, which can be used to open the file in a browser and execute the JavaScript. 
- Under default settings, impact is “limited” because only admins or the uploader can usually view these files—yet this still enables targeted admin compromise via a crafted link. 

------

## Experiment Flow (End-to-End, High-Level)

### Phase A — Baseline (Expected Safe Behavior)

1. Start OpenWebUI in a lab environment.
2. Confirm normal admin behavior (no unexpected requests leaving the browser on file views).
3. Capture baseline screenshots/logs.

### Phase B — Attacker Preparation (Listener)

1. Start a simple listener endpoint to receive inbound HTTP requests (lab-only).
2. Keep it running as you proceed.

### Phase C — XSS Seed (Low-Privileged Upload)

1. Log in as a **regular user**.
2. Upload an **HTML file** through the **files** API endpoint (`/api/v1/files/`) with embedded JavaScript.
   - Payload concept (placeholder): JavaScript that reads client-side auth material and sends it to the listener.
3. Record the returned **file id**. 

### Phase D — Trigger (Admin Views the File)

1. Log in as **admin** in a separate session.
2. Open the uploaded file via the application path that **renders the HTML in-browser**.
3. Observe the listener receiving a request carrying exfiltrated data.

### Phase E — Verification (Admin Token / Session Confirmed)

1. Confirm the received token/session material belongs to the admin.
2. Validate that the attacker can impersonate admin via API calls (lab-only). 

### Phase F — Primary Objective (Model Output Manipulation)

Once admin:

1. Navigate to the admin configuration areas that control **model defaults and prompting behavior**.
2. Change one or more “semantic knobs,” such as:
   - default **temperature**
   - **system prompt** / policy prompt
   - prompt templates / wrappers
   - model routing defaults
3. Generate the same prompt before/after the change and record the delta:
   - **Before:** baseline semantic behavior
   - **After:** altered semantics attributable to admin-level configuration tampering

This demonstrates that the exploit chain enables **platform-wide integrity compromise** of AI responses—not just account takeover.

------

## Evidence Collection 

![before](assets\before.png)

![after](assets\after.png)

![root](assets\root.png)

------

## Expected Outcome

- A low-privileged user can upload HTML that executes when rendered in an admin’s browser. 
- The attacker can obtain admin authentication material and impersonate admin. 
- With admin privileges, the attacker can modify model configuration (temperature/prompts/templates) and **reliably influence semantic output** across users.

------

## Public References

- NVD — CVE-2025-46571 
- GitHub Security Advisory — “Limited stored XSS via uploaded HTML file” (CVE-2025-46571)
- OSV — CVE-2025-46571 